<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>KoiBoi</title>
    <link rel="icon" href="favicon.png" />
    <script src="phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="text/javascript">
const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
        default: 'arcade',
        arcade: {
            gravity: 0
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };
    var keys;
    var camera;
    var koi;
    var padGroup;
    var bugs;
    var bugsText;
    var bugsCount = 0;
    const game = new Phaser.Game(config);

     function preload () {
        this.load.image('pond', 'assets/png/pondbottom.png');
        this.load.spritesheet('koiboi', 'assets/png/thisis-spritefish.png',
        {frameWidth: 87, frameHeight: 113});
        this.load.image('land1', 'assets/png/pondedgeleft.png');
        this.load.image('land2', 'assets/png/pondedgeright.png');
        this.load.image('pad1', 'assets/png/pads/pad01.png');
        this.load.image('pad2', 'assets/png/pads/pad02.png');
        this.load.image('pad3', 'assets/png/pads/pad03.png');
        this.load.image('pad4', 'assets/png/pads/pad04.png');
        this.load.image('dragon', 'assets/png/bugs/dragonfly.png');
        this.load.image('spidey', 'assets/png/bugs/waterspider.png');
        this.load.image('fly', 'assets/png/bugs/fly.png');
        this.load.image('worm', 'assets/png/bugs/worm.png')
     }

     function create () {

        //set up world bounds, camera and movement input
        this.physics.world.setBounds(50, -500, 350 * 2, 500 * 2);
        this.cameras.main.setBounds(0, -500, 350 * 2, 500 * 2);
        keys = this.input.keyboard.createCursorKeys();

        //add background image(s)
        this.add.image(0, -500, 'pond').setFlipX(true).setOrigin(0);
        this.add.image(400, -500, 'pond').setFlipX(true).setOrigin(0);
        this.add.image(0, 0, 'pond').setOrigin(0);
        this.add.image(400, 0, 'pond').setOrigin(0);
        
        //add and set up sprite
        this.player = this.physics.add.sprite(400, 450, 'koiboi');
        koi = this.player;
        koi.body.collideWorldBounds = true;
        koi.body.setSize(43, 108);
        koi.body.setOffset(14, -5);

        this.cameras.main.startFollow(koi, true);
        
        this.anims.create({
            key: 'swim',
            frames: this.anims.generateFrameNumbers('koiboi', 
            { frames: [ 0, 1, 2, 3, 4, 5, 6, 7 ] }),
            frameRate: 8,
            repeat: -1
        });

        //add a semi-transparent layer to mimic water surface
        this.add.rectangle(400, 0, 800, 1000, 0x99d9ea, 0.5);

        //add ornamental edges (accounted for in world bounds)
        this.add.image(200, 250, 'land1');
        this.add.image(200, -250, 'land1');
        this.add.image(600, 250, 'land2');
        this.add.image(600, -250, 'land2');

        //add collison elements at random points in rows,

        function getX () {
            for (var i = 0; i < 10; i++) {
                var x = Phaser.Math.Between(100, 700);
                return x;
            }
        };

        padGroup = this.physics.add.staticGroup({
            key: ['pad1', 'pad2', 'pad3', 'pad4'],
            frameQuantity: 10,
            immovable: true
        });

        var pads = padGroup.getChildren();

        for (var i = 0; i < pads.length; i++) {
            var x = Phaser.Math.Between(100, 700);
            var y = Phaser.Math.Between(300, -400);

            pads[i].setPosition(x, y).setSize(30,30);
            
        }

        padGroup.refresh();

        this.physics.add.collider(koi, padGroup)
        /*pads.create(getX(), 300, 'pad1');
        pads.create(getX(), 300, 'pad2');
        pads.create(getX(), 300, 'pad3');
        pads.create(getX(), 300, 'pad4');
        pads.create(getX(), 225, 'pad1');
        pads.create(getX(), 225, 'pad2');
        pads.create(getX(), 225, 'pad3');
        pads.create(getX(), 225, 'pad4');*/


        //add collectable elements
        bugsGroup = this.physics.add.staticGroup({
            key: ['dragon', 'spidey', 'fly'],
            frameQuantity: 4,
            immovable: true
        });

        const bugs = bugsGroup.getChildren();

        for (var i = 0; i < bugs.length; i++)
        {
            var x = Phaser.Math.Between(100, 700);
            var y = Phaser.Math.Between(350, -500);

            bugs[i].setPosition(x, y);
        }

        bugsGroup.refresh();

        this.physics.add.overlap(koi, bugsGroup, bugHit);
        bugsCount = bugs.length;
        bugsText = this.add.text(100, 20, 'Bugs left: ' + bugsCount);
        bugsText.scrollFactorX = 0
        bugsText.scrollFactorY = 0
     }

    function bugHit (koi, bug) {
        bugsGroup.killAndHide(bug);
        bug.body.enable = false;
        bugsCount -= 1;
     }


    function update () {
        this.player.setVelocity(0);
        bugsText.setText('Bugs left: ' + bugsCount);

        if (keys.right.isDown) {
            this.player.setVelocityX(300)
            this.player.play('swim', true)
        } else if (keys.left.isDown) {
            this.player.setVelocityX(-300)
            this.player.play('swim', true)
        } else if (keys.up.isDown) {
            this.player.setVelocityY(-300)
            this.player.play('swim', true)
        } else if (keys.down.isDown) {
            this.player.setVelocityY(300)
            this.player.play('swim', true)
        } else {
            this.player.stop();
            this.player.setFrame(3)
        }

    }


</script>
</body>
</html>